<?xml version="1.0"?>
<robot xmlns: xacro="http://www.ros.org/wiki/xacro">
  
  <!-- ===================================================================== -->
  <!-- SENSOR MACROS                                                          -->
  <!-- ===================================================================== -->
  
  <!-- Include materials -->
  <xacro: include filename="$(find tmr_description)/urdf/materials.xacro"/>
  
  <!-- PI constant -->
  <xacro: property name="pi" value="3.14159265359"/>
  
  <!-- ===================================================================== -->
  <!-- IMU MACRO (MPU6050)                                                    -->
  <!-- ===================================================================== -->
  <xacro: macro name="imu_sensor" params="name parent_link x y z roll pitch yaw">
    
    <!-- IMU Link -->
    <link name="${name}_link">
      <visual>
        <geometry>
          <box size="0.018 0.025 0.005"/>
        </geometry>
        <material name="red"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.020 0.027 0.007"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.005"/>
        <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
      </inertial>
    </link>
    
    <!-- IMU Joint -->
    <joint name="${parent_link}_to_${name}" type="fixed">
      <parent link="${parent_link}"/>
      <child link="${name}_link"/>
      <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}"/>
    </joint>
    
  </xacro:macro>
  
  <!-- ===================================================================== -->
  <!-- RGB CAMERA MACRO (IMX500)                                              -->
  <!-- ===================================================================== -->
  <xacro:macro name="rgb_camera" params="name parent_link x y z roll pitch yaw">
    
    <!-- Camera Link -->
    <link name="${name}_link">
      <visual>
        <geometry>
          <box size="0.009 0.025 0.024"/>
        </geometry>
        <material name="blue"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.011 0.027 0.026"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.010"/>
        <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
      </inertial>
    </link>
    
    <!-- Camera Optical Frame -->
    <!-- Convention: Z forward, X right, Y down -->
    <link name="${name}_optical_frame"/>
    
    <!-- Camera Joint (to parent) -->
    <joint name="${parent_link}_to_${name}" type="fixed">
      <parent link="${parent_link}"/>
      <child link="${name}_link"/>
      <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}"/>
    </joint>
    
    <!-- Optical Frame Joint -->
    <joint name="${name}_to_optical" type="fixed">
      <parent link="${name}_link"/>
      <child link="${name}_optical_frame"/>
      <origin xyz="0 0 0" rpy="${-pi/2} 0 ${-pi/2}"/>
    </joint>
    
  </xacro:macro>
  
  <!-- ===================================================================== -->
  <!-- TOF CAMERA MACRO (Arducam B0410)                                       -->
  <!-- ===================================================================== -->
  <xacro:macro name="tof_camera" params="name parent_link x y z roll pitch yaw">
    
    <!-- ToF Link -->
    <link name="${name}_link">
      <visual>
        <geometry>
          <box size="0.030 0.050 0.050"/>
        </geometry>
        <material name="green"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.032 0.052 0.052"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.025"/>
        <inertia ixx="0.000005" ixy="0" ixz="0" iyy="0.000005" iyz="0" izz="0.000005"/>
      </inertial>
    </link>
    
    <!-- ToF Optical Frame -->
    <link name="${name}_optical_frame"/>
    
    <!-- ToF Joint (to parent) -->
    <joint name="${parent_link}_to_${name}" type="fixed">
      <parent link="${parent_link}"/>
      <child link="${name}_link"/>
      <origin xyz="${x} ${y} ${z}" rpy="${roll} ${pitch} ${yaw}"/>
    </joint>
    
    <!-- Optical Frame Joint -->
    <joint name="${name}_to_optical" type="fixed">
      <parent link="${name}_link"/>
      <child link="${name}_optical_frame"/>
      <origin xyz="0 0 0" rpy="${-pi/2} 0 ${-pi/2}"/>
    </joint>
    
  </xacro:macro>

</robot>